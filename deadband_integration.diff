--- train_control_platform.py (original)+++ train_control_platform.py (modified)@@ -1046,7 +1046,29 @@                 'step_test_active': 'Prueba de escalÃ³n activa',
                 'step_test_stopped': 'Prueba de escalÃ³n detenida',
                 'step_esp32_status': 'Estado ESP32 (EscalÃ³n)',
-                'configure_step_first': 'Configure los parÃ¡metros del escalÃ³n primero'
+                'configure_step_first': 'Configure los parÃ¡metros del escalÃ³n primero',
+
+                # Deadband Calibration
+                'deadband_tab': 'ðŸ”§ CalibraciÃ³n Deadband',
+                'deadband_title': 'CalibraciÃ³n de Zona Muerta',
+                'deadband_config': 'ConfiguraciÃ³n de CalibraciÃ³n',
+                'start_calibration': 'Iniciar CalibraciÃ³n',
+                'stop_calibration': 'Detener CalibraciÃ³n',
+                'motion_threshold': 'Umbral de Movimiento (cm)',
+                'deadband_direction': 'DirecciÃ³n',
+                'calibration_result': 'Resultado de CalibraciÃ³n',
+                'apply_to_pid': 'Aplicar a PID',
+                'deadband_value': 'Valor Deadband',
+                'calibration_in_progress': 'ðŸ”„ CalibraciÃ³n en progreso...',
+                'calibration_complete': 'âœ“ CalibraciÃ³n completa',
+                'deadband_pwm_graph': 'PWM vs Tiempo',
+                'deadband_distance_graph': 'Distancia vs Tiempo',
+                'deadband_curve_graph': 'Curva de CalibraciÃ³n (PWM vs Distancia)',
+                'pwm_value': 'PWM',
+                'initial_distance': 'Distancia Inicial',
+                'motion_detected': 'Movimiento Detectado',
+                'calibrating': 'Calibrando...',
+                'deadband_applied': 'âœ“ Deadband aplicado al modo PID'
             },
             'en': {
                 'title': 'Train PID Control System',
@@ -1187,7 +1209,29 @@                 'step_test_active': 'Step test active',
                 'step_test_stopped': 'Step test stopped',
                 'step_esp32_status': 'ESP32 Status (Step)',
-                'configure_step_first': 'Configure step parameters first'
+                'configure_step_first': 'Configure step parameters first',
+
+                # Deadband Calibration
+                'deadband_tab': 'ðŸ”§ Deadband Calibration',
+                'deadband_title': 'Deadband Calibration',
+                'deadband_config': 'Calibration Configuration',
+                'start_calibration': 'Start Calibration',
+                'stop_calibration': 'Stop Calibration',
+                'motion_threshold': 'Motion Threshold (cm)',
+                'deadband_direction': 'Direction',
+                'calibration_result': 'Calibration Result',
+                'apply_to_pid': 'Apply to PID',
+                'deadband_value': 'Deadband Value',
+                'calibration_in_progress': 'ðŸ”„ Calibration in progress...',
+                'calibration_complete': 'âœ“ Calibration complete',
+                'deadband_pwm_graph': 'PWM vs Time',
+                'deadband_distance_graph': 'Distance vs Time',
+                'deadband_curve_graph': 'Calibration Curve (PWM vs Distance)',
+                'pwm_value': 'PWM',
+                'initial_distance': 'Initial Distance',
+                'motion_detected': 'Motion Detected',
+                'calibrating': 'Calibrating...',
+                'deadband_applied': 'âœ“ Deadband applied to PID mode'
             }
         }
 
@@ -1677,7 +1721,8 @@                 dcc.Tab(label=self.t('network_tab'), value='network-tab'),
                 dcc.Tab(label=self.t('control_tab'), value='control-tab'),
                 dcc.Tab(label=self.t('step_response_tab'), value='step-response-tab'),
-                dcc.Tab(label=self.t('data_tab'), value='data-tab')
+                dcc.Tab(label=self.t('data_tab'), value='data-tab'),
+                dcc.Tab(label=self.t('deadband_tab'), value='deadband-tab')
             ], style={'marginBottom': '12px', 'height': '36px'}, content_style={'padding': '12px'}),
 
             # Experiment mode store
@@ -2044,6 +2089,125 @@             ], style={'display': 'flex', 'gap': '20px'})
         ])
 
+def create_deadband_tab(self):
+    """Create deadband calibration tab"""
+    return html.Div([
+        html.H3(self.t('deadband_title'), style={'color': self.colors['text'], 'marginBottom': '20px'}),
+
+        html.Div([
+            # Left column - Configuration Panel
+            html.Div([
+                html.Div([
+                    html.H4(self.t('deadband_config'),
+                           style={'color': self.colors['primary'], 'marginBottom': '15px', 'fontSize': '16px'}),
+
+                    # Direction
+                    html.Div([
+                        html.Label(f"{self.t('deadband_direction')}:",
+                                 style={'fontWeight': '500', 'fontSize': '13px', 'marginBottom': '8px',
+                                       'display': 'block'}),
+                        dcc.RadioItems(
+                            id='deadband-direction-radio',
+                            options=[
+                                {'label': f"  {self.t('forward')}", 'value': 1},
+                                {'label': f"  {self.t('reverse')}", 'value': 0}
+                            ],
+                            value=1,
+                            inline=True,
+                            style={'fontSize': '13px'},
+                            labelStyle={'marginRight': '20px', 'cursor': 'pointer'}
+                        )
+                    ], style={'marginBottom': '15px', 'padding': '10px', 'backgroundColor': '#f8f9fa',
+                             'borderRadius': '6px'}),
+
+                    # Motion Threshold
+                    html.Div([
+                        html.Label(f"{self.t('motion_threshold')}:",
+                                 style={'fontWeight': '500', 'fontSize': '13px', 'marginBottom': '8px',
+                                       'display': 'block'}),
+                        dcc.Input(id='deadband-threshold-input', type='number',
+                                value=0.08, min=0.01, max=1.0, step=0.01,
+                                style={'width': '80px', 'height': '28px', 'fontSize': '12px',
+                                      'padding': '4px'})
+                    ], style={'marginBottom': '15px', 'padding': '10px', 'backgroundColor': '#f8f9fa',
+                             'borderRadius': '6px'}),
+
+                    # Start/Stop Buttons
+                    html.Div([
+                        html.Button(self.t('start_calibration'), id='deadband-start-btn', n_clicks=0,
+                                  style={'backgroundColor': '#28A745', 'color': 'white', 'padding': '10px 20px',
+                                        'border': 'none', 'borderRadius': '6px', 'fontSize': '14px',
+                                        'cursor': 'pointer', 'marginRight': '10px'}),
+                        html.Button(self.t('stop_calibration'), id='deadband-stop-btn', n_clicks=0,
+                                  style={'backgroundColor': '#DC3545', 'color': 'white', 'padding': '10px 20px',
+                                        'border': 'none', 'borderRadius': '6px', 'fontSize': '14px',
+                                        'cursor': 'pointer'})
+                    ], style={'marginBottom': '20px'}),
+
+                    # Status Display
+                    html.Div(id='deadband-status',
+                           style={'fontSize': '13px', 'padding': '12px', 'backgroundColor': '#f8f9fa',
+                                 'borderRadius': '6px', 'marginBottom': '15px', 'minHeight': '60px'}),
+
+                    # Result Display
+                    html.Div([
+                        html.H5(self.t('calibration_result'),
+                               style={'fontSize': '14px', 'marginBottom': '10px', 'color': self.colors['text']}),
+                        html.Div(id='deadband-result',
+                               style={'fontSize': '32px', 'fontWeight': 'bold', 'color': '#28A745',
+                                     'textAlign': 'center', 'padding': '20px', 'backgroundColor': '#f8f9fa',
+                                     'borderRadius': '6px', 'marginBottom': '15px'}),
+                        html.Button(self.t('apply_to_pid'), id='deadband-apply-btn', n_clicks=0,
+                                  disabled=True,
+                                  style={'width': '100%', 'padding': '10px', 'backgroundColor': '#007BFF',
+                                        'color': 'white', 'border': 'none', 'borderRadius': '6px',
+                                        'fontSize': '14px', 'cursor': 'pointer'})
+                    ])
+
+                ], style={'background': 'white', 'padding': '15px', 'borderRadius': '8px',
+                         'boxShadow': '0 1px 4px rgba(0,0,0,0.1)'})
+            ], style={'width': '35%', 'paddingRight': '20px'}),
+
+            # Right column - Graphs
+            html.Div([
+                # PWM vs Time
+                html.Div([
+                    html.H4(self.t('deadband_pwm_graph'),
+                           style={'textAlign': 'center', 'color': self.colors['primary'],
+                                 'marginBottom': '8px', 'fontSize': '14px'}),
+                    dcc.Graph(id='deadband-pwm-graph',
+                             figure=px.line(),
+                             style={'height': '250px'})
+                ], style={'background': 'white', 'padding': '12px', 'borderRadius': '8px',
+                         'boxShadow': '0 1px 4px rgba(0,0,0,0.1)', 'marginBottom': '15px'}),
+
+                # Distance vs Time
+                html.Div([
+                    html.H4(self.t('deadband_distance_graph'),
+                           style={'textAlign': 'center', 'color': self.colors['primary'],
+                                 'marginBottom': '8px', 'fontSize': '14px'}),
+                    dcc.Graph(id='deadband-distance-graph',
+                             figure=px.line(),
+                             style={'height': '250px'})
+                ], style={'background': 'white', 'padding': '12px', 'borderRadius': '8px',
+                         'boxShadow': '0 1px 4px rgba(0,0,0,0.1)', 'marginBottom': '15px'}),
+
+                # Calibration Curve
+                html.Div([
+                    html.H4(self.t('deadband_curve_graph'),
+                           style={'textAlign': 'center', 'color': self.colors['primary'],
+                                 'marginBottom': '8px', 'fontSize': '14px'}),
+                    dcc.Graph(id='deadband-curve-graph',
+                             figure=px.line(),
+                             style={'height': '300px'})
+                ], style={'background': 'white', 'padding': '12px', 'borderRadius': '8px',
+                         'boxShadow': '0 1px 4px rgba(0,0,0,0.1)'})
+
+            ], style={'width': '65%'})
+
+        ], style={'display': 'flex', 'gap': '20px'})
+    ])
+
     def setup_callbacks(self):
         """Setup all dashboard callbacks"""
 
@@ -2069,9 +2233,15 @@         )
         def update_mode_indicator(active_tab, language_data):
             """Update the mode indicator badge based on active tab"""
-            is_step = active_tab == 'step-response-tab'
-            mode_text = 'Step Response' if is_step else 'PID Control'
-            badge_color = '#28A745' if is_step else '#007BFF'  # Green for step, blue for PID
+            if active_tab == 'step-response-tab':
+                mode_text = 'Step Response'
+                badge_color = '#28A745'
+            elif active_tab == 'deadband-tab':
+                mode_text = 'Deadband Cal'
+                badge_color = '#FFA500'  # Orange
+            else:
+                mode_text = 'PID Control'
+                badge_color = '#007BFF'  # Green for step, blue for PID
             
             return html.Span(mode_text, style={
                 'backgroundColor': badge_color,
@@ -2180,6 +2350,8 @@                 return self.create_data_tab()
             elif active_tab == 'step-response-tab':
                 return self.create_step_response_tab()
+            elif active_tab == 'deadband-tab':
+                return self.create_deadband_tab()
             return html.Div(self.t('tab_not_found'))
 
         # Network configuration callbacks
@@ -2789,6 +2961,349 @@                 )
                 return fig
 
+        # =====================================================================
+        # Deadband Calibration Callbacks
+        # =====================================================================
+
+        @self.app.callback(
+            [Output('deadband-status', 'children'),
+             Output('deadband-result', 'children'),
+             Output('deadband-apply-btn', 'disabled')],
+            [Input('deadband-start-btn', 'n_clicks'),
+             Input('deadband-stop-btn', 'n_clicks'),
+             Input('graph-update-interval', 'n_intervals')],
+            [State('deadband-direction-radio', 'value'),
+             State('deadband-threshold-input', 'value')],
+            prevent_initial_call=True
+        )
+        def handle_deadband_calibration(start_clicks, stop_clicks, n_intervals,
+                                        direction, threshold):
+            """Handle deadband calibration start/stop and status updates"""
+            ctx = callback_context
+        
+            if not ctx.triggered:
+                raise PreventUpdate
+        
+            trigger_id = ctx.triggered[0]['prop_id'].split('.')[0]
+        
+            # Check network configuration
+            if not self.network_manager.selected_ip:
+                return (html.Div(self.t('configure_network_warning'),
+                                style={'color': '#DC3545'}),
+                        "", True)
+        
+            # Start calibration
+            if trigger_id == 'deadband-start-btn' and start_clicks > 0:
+                try:
+                    # Switch to deadband data manager
+                    self.experiment_mode = 'deadband'
+                    self.udp_receiver.set_data_manager(self.deadband_data_manager)
+        
+                    # Clear previous calibration data
+                    self.deadband_data_manager.clear_history()
+        
+                    # Create new CSV file
+                    csv_path = self.deadband_data_manager.create_deadband_csv()
+                    print(f"Deadband calibration CSV: {csv_path}")
+        
+                    # Send configuration via MQTT
+                    self.mqtt_sync.publish(MQTT_TOPICS['deadband_direction'], str(direction))
+                    time.sleep(0.05)
+                    self.mqtt_sync.publish(MQTT_TOPICS['deadband_threshold'], str(threshold))
+                    time.sleep(0.05)
+        
+                    # Start calibration
+                    self.mqtt_sync.publish(MQTT_TOPICS['deadband_sync'], "True")
+        
+                    return (html.Div(self.t('calibration_in_progress'),
+                                    style={'color': '#FFA500'}),
+                            "", True)
+        
+                except Exception as e:
+                    return (html.Div(f"Error: {str(e)}", style={'color': '#DC3545'}),
+                            "", True)
+        
+            # Stop calibration
+            elif trigger_id == 'deadband-stop-btn' and stop_clicks > 0:
+                try:
+                    self.mqtt_sync.publish(MQTT_TOPICS['deadband_sync'], "False")
+        
+                    return (html.Div(self.t('calibration_complete'),
+                                    style={'color': '#28A745'}),
+                            f"{self.deadband_data_manager.calibrated_deadband} PWM",
+                            False if self.deadband_data_manager.calibrated_deadband > 0 else True)
+        
+                except Exception as e:
+                    return (html.Div(f"Error: {str(e)}", style={'color': '#DC3545'}),
+                            "", True)
+        
+            # Status updates (check for calibration result)
+            elif trigger_id == 'graph-update-interval':
+                # Check if calibration has completed
+                if self.deadband_data_manager.calibrated_deadband > 0:
+                    return (html.Div(self.t('calibration_complete'),
+                                    style={'color': '#28A745'}),
+                            f"{self.deadband_data_manager.calibrated_deadband} PWM",
+                            False)
+                elif len(self.deadband_data_manager.deadband_history['pwm']) > 0:
+                    # Calibration in progress
+                    current_pwm = self.deadband_data_manager.deadband_history['pwm'][-1]
+                    return (html.Div(f"{self.t('calibrating')} PWM: {current_pwm}",
+                                    style={'color': '#FFA500'}),
+                            "", True)
+        
+            raise PreventUpdate
+        
+        
+        # ==========================
+        # CALLBACK 2: Apply Deadband to PID
+        # ==========================
+        
+        @self.app.callback(
+            Output('deadband-status', 'children', allow_duplicate=True),
+            Input('deadband-apply-btn', 'n_clicks'),
+            State('deadband-result', 'children'),
+            prevent_initial_call=True
+        )
+        def apply_deadband_to_pid(n_clicks, result_text):
+            """Apply calibrated deadband value to PID mode"""
+            if n_clicks > 0 and result_text:
+                try:
+                    # Send apply command via MQTT
+                    self.mqtt_sync.publish(MQTT_TOPICS['deadband_apply'], "True")
+        
+                    return html.Div(self.t('deadband_applied'),
+                                   style={'color': '#28A745', 'fontWeight': 'bold'})
+        
+                except Exception as e:
+                    return html.Div(f"Error applying deadband: {str(e)}",
+                                   style={'color': '#DC3545'})
+        
+            raise PreventUpdate
+        
+        
+        # ==========================
+        # CALLBACK 3: Update PWM vs Time Graph
+        # ==========================
+        
+        @self.app.callback(
+            Output('deadband-pwm-graph', 'figure'),
+            Input('graph-update-interval', 'n_intervals')
+        )
+        def update_deadband_pwm_graph(n):
+            """Update PWM vs Time graph"""
+            try:
+                data = self.deadband_data_manager.deadband_history
+        
+                if len(data['time']) == 0:
+                    # No data yet
+                    fig = px.line()
+                    fig.update_layout(
+                        title=self.t('deadband_pwm_graph'),
+                        xaxis_title=self.t('time') + ' (ms)',
+                        yaxis_title='PWM',
+                        template='plotly_white'
+                    )
+                    return fig
+        
+                fig = go.Figure()
+        
+                # PWM trace
+                fig.add_trace(go.Scatter(
+                    x=data['time'],
+                    y=data['pwm'],
+                    mode='lines',
+                    name='PWM',
+                    line=dict(color='blue', width=2)
+                ))
+        
+                # Mark motion detection point
+                if 1 in data['motion_detected']:
+                    idx = data['motion_detected'].index(1)
+                    fig.add_trace(go.Scatter(
+                        x=[data['time'][idx]],
+                        y=[data['pwm'][idx]],
+                        mode='markers+text',
+                        name=self.t('motion_detected'),
+                        marker=dict(color='red', size=15, symbol='star'),
+                        text=[f"PWM={data['pwm'][idx]}"],
+                        textposition='top center'
+                    ))
+        
+                fig.update_layout(
+                    title=self.t('deadband_pwm_graph'),
+                    xaxis_title=self.t('time') + ' (ms)',
+                    yaxis_title='PWM',
+                    hovermode='x unified',
+                    template='plotly_white',
+                    showlegend=True
+                )
+        
+                return fig
+        
+            except Exception as e:
+                print(f"Error updating PWM graph: {e}")
+                return px.line()
+        
+        
+        # ==========================
+        # CALLBACK 4: Update Distance vs Time Graph
+        # ==========================
+        
+        @self.app.callback(
+            Output('deadband-distance-graph', 'figure'),
+            Input('graph-update-interval', 'n_intervals')
+        )
+        def update_deadband_distance_graph(n):
+            """Update Distance vs Time graph"""
+            try:
+                data = self.deadband_data_manager.deadband_history
+        
+                if len(data['time']) == 0:
+                    fig = px.line()
+                    fig.update_layout(
+                        title=self.t('deadband_distance_graph'),
+                        xaxis_title=self.t('time') + ' (ms)',
+                        yaxis_title=self.t('distance_cm'),
+                        template='plotly_white'
+                    )
+                    return fig
+        
+                fig = go.Figure()
+        
+                # Distance trace
+                fig.add_trace(go.Scatter(
+                    x=data['time'],
+                    y=data['distance'],
+                    mode='lines',
+                    name=self.t('distance_cm'),
+                    line=dict(color='green', width=2)
+                ))
+        
+                # Initial distance reference line
+                if len(data['initial_distance']) > 0:
+                    fig.add_trace(go.Scatter(
+                        x=data['time'],
+                        y=data['initial_distance'],
+                        mode='lines',
+                        name=self.t('initial_distance'),
+                        line=dict(color='gray', width=1, dash='dash')
+                    ))
+        
+                    # Motion threshold bands
+                    threshold = 0.08  # Get from UI state if needed
+                    initial = data['initial_distance'][0]
+                    fig.add_hrect(
+                        y0=initial - threshold,
+                        y1=initial + threshold,
+                        fillcolor="yellow",
+                        opacity=0.2,
+                        line_width=0,
+                        annotation_text=self.t('motion_threshold')
+                    )
+        
+                # Mark motion detection point
+                if 1 in data['motion_detected']:
+                    idx = data['motion_detected'].index(1)
+                    fig.add_trace(go.Scatter(
+                        x=[data['time'][idx]],
+                        y=[data['distance'][idx]],
+                        mode='markers',
+                        name=self.t('motion_detected'),
+                        marker=dict(color='red', size=12, symbol='star')
+                    ))
+        
+                fig.update_layout(
+                    title=self.t('deadband_distance_graph'),
+                    xaxis_title=self.t('time') + ' (ms)',
+                    yaxis_title=self.t('distance_cm'),
+                    hovermode='x unified',
+                    template='plotly_white',
+                    showlegend=True
+                )
+        
+                return fig
+        
+            except Exception as e:
+                print(f"Error updating distance graph: {e}")
+                return px.line()
+        
+        
+        # ==========================
+        # CALLBACK 5: Update Calibration Curve (PWM vs Distance)
+        # ==========================
+        
+        @self.app.callback(
+            Output('deadband-curve-graph', 'figure'),
+            Input('graph-update-interval', 'n_intervals')
+        )
+        def update_deadband_curve_graph(n):
+            """Update PWM vs Distance calibration curve"""
+            try:
+                data = self.deadband_data_manager.deadband_history
+        
+                if len(data['pwm']) == 0:
+                    fig = px.line()
+                    fig.update_layout(
+                        title=self.t('deadband_curve_graph'),
+                        xaxis_title='PWM',
+                        yaxis_title=self.t('distance_cm'),
+                        template='plotly_white'
+                    )
+                    return fig
+        
+                fig = go.Figure()
+        
+                # Main calibration curve
+                fig.add_trace(go.Scatter(
+                    x=data['pwm'],
+                    y=data['distance'],
+                    mode='lines+markers',
+                    name=self.t('calibration_result'),
+                    line=dict(color='purple', width=2),
+                    marker=dict(size=4)
+                ))
+        
+                # Mark deadband point
+                if 1 in data['motion_detected']:
+                    idx = data['motion_detected'].index(1)
+                    deadband_pwm = data['pwm'][idx]
+                    deadband_distance = data['distance'][idx]
+        
+                    fig.add_trace(go.Scatter(
+                        x=[deadband_pwm],
+                        y=[deadband_distance],
+                        mode='markers+text',
+                        name=f'Deadband = {deadband_pwm}',
+                        marker=dict(color='red', size=15, symbol='star'),
+                        text=[f'{deadband_pwm}'],
+                        textposition='top center'
+                    ))
+        
+                    # Vertical line at deadband
+                    fig.add_vline(
+                        x=deadband_pwm,
+                        line_dash="dash",
+                        line_color="red",
+                        annotation_text=f"Deadband: {deadband_pwm} PWM",
+                        annotation_position="top"
+                    )
+        
+                fig.update_layout(
+                    title=self.t('deadband_curve_graph'),
+                    xaxis_title='PWM',
+                    yaxis_title=self.t('distance_cm'),
+                    hovermode='closest',
+                    template='plotly_white',
+                    showlegend=True
+                )
+        
+                return fig
+        
+            except Exception as e:
+                print(f"Error updating curve graph: {e}")
+                return px.line()
+
     def _get_step_parameter_status_display(self):
         """Display confirmed step response parameters from ESP32"""
         if not hasattr(self, 'mqtt_sync') or not self.mqtt_sync:
